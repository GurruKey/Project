# Data Model  сущности и доступ (черновик)

## Принципы
- Все пользовательские таблицы с включённым RLS.
- Доступ пользователя  по uth.uid() (владелец записи).
- Админские операции  через сервер/edge с service role + отдельные policy.

## Сущности (MVP и рядом)
### users
- Назначение: учётная запись (метаданные профиля).
- CRUD: пользователь  читает/меняет своё; админ  может читать больше.
- RLS (словами): user_id = auth.uid(); для админов  роль-проверка.

### roles, permissions, user_roles
- Назначение: роли и права, привязка пользователей к ролям.
- CRUD: только админ.
- RLS: чтение  админ/модератор; запись  админ.

### audit_logs
- Назначение: журнал действий (кто/что/когда [+контекст]).
- CRUD: запись  система/сервер; чтение  админ/модератор.
- RLS: запрет на чтение обычным пользователям.

### games
- Назначение: каталог слотов (метаданные, обложка, теги, RTP/volatility  плейсхолдеры).
- CRUD: чтение  все; запись  админ.
- RLS: публичное чтение, запись по роли.

### bets
- Назначение: ставки пользователя (плейсхолдер до реальной механики).
- CRUD: создание  владелец; чтение  владелец/админ.
- RLS: user_id = auth.uid(); админский обход политикой.

### game_rounds
- Назначение: результат раундов (демо/реал  позже).
- CRUD: запись  система; чтение  владелец/админ.
- RLS: user_id = auth.uid(); админское чтение разрешено.

### promos
- Назначение: промокоды/правила (пост-MVP).
- CRUD: чтение  все; запись  админ.
- RLS: публичное чтение, запись по роли.

### referrals
- Назначение: связи кто кого пригласил.
- CRUD: запись  система; чтение  владелец/админ.
- RLS: фильтр по user_id.

### wallets (пост-MVP)
- Назначение: кошельки пользователей.
- CRUD: запись  система/сервер; чтение  владелец/админ.
- RLS: user_id = auth.uid(); админ  по роли.

### transactions (пост-MVP)
- Назначение: пополнения/выводы/бонусы.
- CRUD: запись  система/сервер; чтение  владелец/админ.
- RLS: фильтр по user_id; админ  по роли.

## Поля (черновой минимум)
- id (uuid, pk)
- created_at, updated_at (timestamptz, default now())
- user_id (uuid, fk  auth.users)  где применимо
- role (text/enum)  для ролей
- metadata (jsonb)  расширяемые поля (где нужно)
